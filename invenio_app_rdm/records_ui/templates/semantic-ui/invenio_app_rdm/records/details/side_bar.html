{#
  Copyright (C) 2020 CERN.
  Copyright (C) 2020 Northwestern University.
  Copyright (C) 2021 TU Wien.

  Invenio RDM Records is free software; you can redistribute it and/or modify
  it under the terms of the MIT License; see LICENSE file for more details.
#}

{%- from "invenio_app_rdm/records/macros/version.html" import show_version %}

{%- from "invenio_app_rdm/records/macros/detail.html" import list_formats, list_languages,
  list_sizes, show_dates, show_detail, show_alternate_identifiers, show_dates, show_funding %}

{#
<!-- TODO add again once the metrics are working -->
<div class="ui segment rdm-sidebar">
  <h2 class="ui small header">{{ _('Metrics')}}</h2>
  <hr class="thin-line">
  </hr>
  <dd>
    <!-- Stats -->
    {%- include "invenio_app_rdm/landing_page/details/stats.html" %}
  </dd>
</div>
#}


{# Versions #}
<div class="ui segment rdm-sidebar">
  <h2 class="ui small header">{{ _('Versions')}}</h2>
  <hr class="thin-line"/>
  <dd class="versions">
    <div id="recordVersions" data-record='{{ record | tojson }}' data-preview='{{ is_preview | tojson }}'></div>
  </dd>
</div>


{# Keywords & Subjects #}
{% if record.metadata.subjects %}
<div class="ui segment rdm-sidebar">
  <h2 class="ui small header">{{ _('Keywords') }} & {{ _('Subjects') }}</h2>
  <hr class="thin-line"/>
  {%- include "invenio_app_rdm/records/details/subjects.html" %}
</div>
{% endif %}


{# Identifiers #}
{%- set id_doi = record.pids.get('doi', {}).get('identifier') %}
{% if id_doi or metadata.identifiers %}
<div class="ui segment rdm-sidebar">
  <h2 class="ui small header">{{ _('Identifiers') }}</h2>
  <hr class="thin-line"/>

  {%- include "invenio_app_rdm/records/details/doi.html" %}

  {% if metadata.identifiers %}
    {{ show_alternate_identifiers(metadata.identifiers) }}
  {% endif %}
</div>
{% endif %}


{# Details #}
<div class="ui segment rdm-sidebar">
  <h2 class="ui small header">{{ _('Details')}}</h2>
  <hr class="thin-line"/>

  <dl class="details-list">
    {{ show_detail(_('Resource type'), record.ui.resource_type.title_l10n) if record.ui.resource_type }}
    {{ show_detail(_('Publication date'), record.ui.publication_date_l10n) if record.ui.publication_date_l10n }}
    {{ show_detail(_('Publisher'), metadata.publisher) if metadata.publisher }}
    {{ show_detail(_('Languages'), list_languages(record.ui.languages)) if record.ui.languages }}
    {{ show_detail(_('Formats'), list_formats(metadata.formats)) if metadata.formats }}
    {{ show_detail(_('Sizes'), list_sizes(metadata.sizes)) if metadata.sizes }}
  </dl>

  {% if record.ui.dates %}
  <hr class="thin-line"/>

  <dl class="details-list">
    {{ show_dates(record.ui.dates) }}
  </dl>
  {% endif %}
</div>


{# Funding #}
{% if metadata.funding %}
<div class="ui segment rdm-sidebar">
  <h2 class="ui small header">{{ _('Funding') }}</h2>
  <hr class="thin-line"/>
  <dl class="details-list">
    {{ show_funding(metadata.funding) }}
  </dl>
</div>
{% endif %}


{# Licences #}
{% set rights = record.ui.get('rights') %}
{% if rights %}
<div class="ui segment rdm-sidebar">
  <h2 class="ui small header">{{ _('Licenses')}}</h2>
  <hr class="thin-line"/>
  {%- include "invenio_app_rdm/records/details/licenses.html" %}
</div>
{% endif %}


{# Upload info #}
<div class="ui segment rdm-sidebar">
  <h2 class="ui small header">{{ _('Upload information')}}</h2>
  <hr class="thin-line"/>
  <dl class="details-list">
    <dt class="ui tiny header">{{ _("Created") }}</dt>
    <dd>
      {{ record.ui.created_date_l10n_long }}
    </dd>
    <dt class="ui tiny header">{{ _("Modified") }}</dt>
    <dd>
      {{ record.ui.updated_date_l10n_long }}
    </dd>
  </dl>
</div>


{# Exports #}
{%- if config.get("APP_RDM_RECORD_EXPORTERS") -%}
{# if no export formats are specified, don't bother showing the box #}
<div class="ui segment rdm-sidebar exports">
  <h2 class="ui small header">{{ _('Export')}}</h2>
  <hr class="thin-line"/>
  <dd class="top-bottom-padded">
    <div class="ui celled horizontal list separated-list">
      {# dynamically create the list of export formats #}
      {%- for fmt, val in config.get("APP_RDM_RECORD_EXPORTERS", {}).items() -%}
        {%- set name = val.get("name", fmt) -%}
        {% if is_preview %}
          {%- set export_url = url_for('invenio_app_rdm_records.record_export', pid_value=record.id, export_format=fmt, preview=1) -%}
        {% else %}
          {%- set export_url = url_for('invenio_app_rdm_records.record_export', pid_value=record.id, export_format=fmt) -%}
        {% endif %}
         <div class="item"><a href="{{ export_url }}">{{ name }}</a></div>
      {%- endfor -%}
    </div>
  </dd>
</div>
{%- endif -%}
