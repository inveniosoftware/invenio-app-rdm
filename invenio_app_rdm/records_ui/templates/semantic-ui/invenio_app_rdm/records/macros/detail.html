{#
  Copyright (C) 2020 CERN.

  Invenio RDM Records is free software; you can redistribute it and/or modify
  it under the terms of the MIT License; see LICENSE file for more details.
#}


{% macro show_detail(title, value) %}
  <dt class="ui tiny header">{{ title }}</dt>
  <dd>
    {{ value }}
  </dd>
{%- endmacro %}

{% macro show_title_detail(title, language, value) %}
  <dt class="ui tiny header">
    {{ title }} 
    <span class="language text-muted">
      {{ '(' + language + ')' if language}}
    </span>
  </dt>
  <dd>
    {{ value }}
  </dd>
{%- endmacro %}

{% macro show_sanitized_detail(title, value) %}
<dt class="ui tiny header">{{ title }}</dt>
<dd>
    {{ value | sanitize_html()| safe }}
</dd>
{%- endmacro %}


{% macro list_sizes(sizes) %}
  {% for size in sizes %}
    {{ size }}{{ ", " if not loop.last }}
  {% endfor %}
{% endmacro %}


{% macro list_formats(formats) %}
  {% for format in formats %}
    {{ format }}{{ ", " if not loop.last }}
  {% endfor %}
{% endmacro %}


{% macro show_add_titles(add_titles) %}
<dl class="details-list">
  {% for add_title in add_titles %}
    {% if add_title.lang %}
      {{ show_title_detail(add_title.type.title_l10n, add_title.lang.title_l10n, add_title.title)}}
    {% else %}
      {{ show_title_detail(add_title.type.title_l10n,None, add_title.title)}}
    {% endif %}
  {% endfor %}
</dl>
{% endmacro %}


{% macro show_add_descriptions(add_descriptions) %}
  {% for add_description in add_descriptions %}
    <h3>{{add_description.type.title_l10n }}</h3>
    <p>{{ add_description.description | sanitize_html() | safe}}</p>
  {% endfor %}
{% endmacro %}


{% macro show_dates(dates) %}
  {% for date in dates %}
    <dt class="ui tiny header">{{ date.type.title_l10n }}</dt>
    <dd>
      <div>{{ date.date }}</div>
      <div class="text-muted">{{ date.description }}</div>
    </dd>
  {% endfor %}
{% endmacro %}


{% macro show_funding(funding) %}
  {% for fund in funding %}
    {{ show_detail('Award', fund.award.title + ' ( ' + fund.award.number + ' )' ) if fund.award }}
    {{ show_detail('Funder', fund.funder.name) if fund.funder }}
  {% endfor %}
{% endmacro %}


{% macro show_references(references) %}
  {% for reference in references %}
    <dd>{{ reference.reference + ' ( ' + reference.scheme + ' - ' +  reference.identifier + ' )'}}</dd>
  {% endfor %}
{% endmacro %}


{% macro _identifiers_for_group(related_identifiers) %}
  {% for identifier in related_identifiers %}
    <dd>
      {% if identifier.resource_type is defined %}
      {{ identifier.resource_type.title_l10n }}: 
      {% endif %}

      {{ identifier.identifier + ' ( ' + identifier.scheme | get_scheme_label + ' )' }}    
    </dd>
  {% endfor %}
{% endmacro %}


{% macro show_related_identifiers(related_identifiers) %}
  {%- for group in related_identifiers | groupby('relation_type.title_l10n')%}
  <dt class="ui tiny header">{{ group.grouper }}</dt>
  {{ _identifiers_for_group(group.list) }}
  {%- endfor %}
{% endmacro %}


{% macro show_alternate_identifiers(identifiers) %}
<dl class="details-list">
  {% for alt_id in identifiers %}
    {# upper() is in keeping with the displayed schemes in RDMDEpositForm.js #}
   {{ show_detail(alt_id.scheme | get_scheme_label, alt_id.identifier) }}
  {% endfor %}
</dl>
{% endmacro %}


{% macro list_languages(languages) %}
  {% for lang in languages %}
    {{ lang.title_l10n }}{{ ", " if not loop.last }}
  {% endfor %}
{% endmacro %}
